steps:
  - id: Installing dependencies for frontend
    name: "gcr.io/cloud-builders/npm"
    args: ["install", "--no-optional", "-f"]
  - id: Installing firebase tools
    name: "gcr.io/cloud-builders/npm"
    args: ["install", "-g", "firebase-tools"]
  - id: Installing firebase
    name: "gcr.io/cloud-builders/npm"
    args: ["install", "--save", "firebase"]
  - id: Installing firebase functions
    name: "gcr.io/cloud-builders/npm"
    args: ["run", "functions-install"]

  # - id: Running tests
  #   name: "gcr.io/cloud-builders/npm"
  #   args: ["run", "test", "--", "--watchAll=false"]

  - id: Selecting firebase env
    name: "gcr.io/$PROJECT_ID/firebase"
    args: ["use", "$BRANCH_NAME"]
  - id: Deploying to firebase
    name: "gcr.io/$PROJECT_ID/firebase"
    args: ["deploy", "--only", "functions", "--project=$PROJECT_ID"]

timeout: 1800s
